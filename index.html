<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Redirect</title>
</head>
<body>
    <h3 id="status">로그인 처리 중...</h3>
    <p id="debug" style="font-size:12px; color:gray;"></p>
    <a id="manual-link" href="#" style="font-size: 16px; padding: 10px; background: #eee; display:none;">앱으로 돌아가기</a>

    <script>
        var query = window.location.search; // ?code=...
        var hash = window.location.hash;    // #access_token=...

        var scheme = "ginovo-unity://";
        var path = "";
        var finalUrl = "";

        // 디버깅용 출력
        document.getElementById("debug").innerText = "Query: " + query + "\nHash: " + hash;

        // 1. 라인 (쿼리에 code가 있음)
        if (query.includes("code=")) {
            path = "line_callback";
            finalUrl = scheme + path + query; // 라인은 ?code=... 그대로 붙임
        }
        // 2. 네이버 (해시에 access_token이 있음)
        else if (hash.includes("access_token=")) {
            path = "naver_callback";
            finalUrl = scheme + path + hash; 
        }
        // 3. 그 외 (에러 등)
        else {
            document.getElementById("status").innerText = "로그인 정보를 찾을 수 없습니다.";
        }

        if (finalUrl !== "") {
            document.getElementById("debug").innerText += "\nTarget: " + finalUrl;
            
            // 링크 버튼에도 주소 심어주기 (자동실행 실패 대비)
            var btn = document.getElementById("manual-link");
            btn.href = finalUrl;
            btn.style.display = "block";
            btn.innerText = "앱이 열리지 않으면 클릭하세요";

            // 0.5초 뒤 자동 이동
            setTimeout(function() {
                window.location.href = finalUrl;
            }, 500);
        }
    </script>
</body>
</html>
